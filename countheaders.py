import re
from collections import *
import sys
import os
import pandas as pd

basepath = "/media/zqz/Newsmy/train/"
rootpath = "/media/zqz/Newsmy/"
map3gram = defaultdict(Counter)
subtrain = pd.read_csv(os.path.join(rootpath,'subtrainLabels.csv'))


mapheader = defaultdict(Counter)
headlist = []

index = 0
for fid in subtrain.Id:
    index += 1
    head = {}
    asmfile = os.path.join(basepath, fid + '.asm')
    tot = 0
    with open(asmfile, encoding="iso-8859-15") as f:
        print("counting " + str(index) + " th asm file headers: " + fid + "...")
        for line in f:
            xx = line.split()
            h = xx[0].split(':')
            if h[0] not in headlist:
                headlist.append(h[0])
            if h[0] not in head:
                head[h[0]] = 0
            head[h[0]] += 1
    mapheader[fid] = head

dataframelist = []
for fid, headers in mapheader.items():
    standard = {}
    standard["Id"] = fid
    for feature in headlist:
        if feature in headers.keys():
            standard[feature] = int(headers[feature])
        else:
            standard[feature] = 0
    dataframelist.append(standard)
df = pd.DataFrame(dataframelist)
df.to_csv(os.path.join(rootpath, "headersfeature.csv"),index=False)
